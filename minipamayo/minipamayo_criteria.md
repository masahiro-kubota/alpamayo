# minipamayo (0.5B VLA) 設計クライテリアまとめ

本ドキュメントは、**Jetson Orin Nano 8GB** 上で **Alpamayo-R1 を簡略化した VLA（仮称: minipamayo, 約0.5B）** を動作させることを前提に、

* 実現可能性のクライテリア（最低限 / がんばれば / 運が良ければ）
* VLM / VLA における **0.5B パラメータ規模**の妥当性
* **テキスト生成と trajectory 生成を同一レートで回すことの難しさ**

を整理した設計指針メモである。

---

## 前提条件（固定）

* デバイス: **Jetson Orin Nano 8GB（統合メモリ）**
* 学習: PC / サーバ GPU
* 推論: Jetson（INT4 量子化前提）
* 入力:

  * 単眼カメラ画像 1 枚
  * 低次元状態履歴（速度・ヨーレート・操舵など）
* 出力:

  * **車体座標系の将来軌道（waypoints）**
  * テキスト出力は可能なら残したい

---

## 標準仕様（初期値）

Jetson 上での安定性と追従制御との相性を優先し、以下を標準とする。

* **horizon**: 2.0 秒
* **waypoints**: 20 点（約 0.1 秒刻み）
* **軌道表現**: 車体座標 (x, y)
* **補助出力（推奨）**:

  * 目標速度 or 加速度
  * 不確実性スカラー（uncertainty）

---

## クライテリア（軌道型 VLA 前提）

### 1. 最低限これはできる（堅実ライン）

**目的:** Jetson 上で確実に軌道を出し続ける。VLA感は最小限。

* policy（軌道生成）: **2–5 Hz**
* 追従制御: **30–50 Hz**（別モジュール）
* テキスト出力: なし、または固定ラベル分類のみ
* 画像解像度: **224–256**
* レイテンシ条件:

  * policy p95 < **250 ms**

**特徴**

* 安定性最優先
* 「走るが喋らない」ライン

---

### 2. がんばればこれくらいできる（実用ライン）

**目的:** VLA らしさ（説明能力）を維持しつつ安定運転。

* policy: **5–10 Hz**
* 追従制御: **50–100 Hz**
* テキスト出力:

  * **イベント時のみ生成**（通常は生成しない）
  * 最大 **16–32 tokens**
* 画像解像度: **256–320**
* レイテンシ条件:

  * policy p95 < **180 ms**
  * テキスト生成中でも p95 が **1.5 倍以内**

**特徴**

* VLA としての体験価値と実運用のバランスが良い
* 本構成が最も現実的な目標

---

### 3. 運が良ければこれくらいできる（挑戦ライン）

**目的:** 常時説明や高解像度など、研究的チャレンジ。

* policy: **10 Hz 維持が目標**
* 追従制御: **100 Hz 前後**
* テキスト出力: 準常時（0.5–2 Hz）
* 画像解像度: **384** 級

**リスク**

* 統合メモリ帯域競合によるレイテンシスパイク
* 再現性が低く、運用が不安定になりやすい

---

## 0.5B パラメータ規模の妥当性

### 結論

* **0.5B は Jetson 向け VLA として「上限寄りだが妥当」**
* 設計次第で成立するが、余裕は少ない

### できること

* 単眼 1 枚 + 状態入力 → 将来軌道生成
* policy 5–10 Hz
* オンデマンド短文テキスト

### 難しいこと

* 常時テキスト生成を policy と同レートで実行
* 高解像度画像や複数フレーム履歴
* 拡散 / flow matching による反復的軌道生成

### 推奨パラメータ配分（目安）

* Vision encoder: **軽量（~100–200M 相当以下）**
* マルチモーダル融合 / Backbone: 重点投資
* Trajectory head / Text head: 軽量

---

## テキスト生成と trajectory 生成を同レートで回す問題

### なぜ厳しいのか

* trajectory 出力は **固定コスト**（出力次元が一定）
* テキスト生成は **可変コスト**:

  * トークン長に依存
  * KV キャッシュ増加
  * フレームごとにレイテンシがばらつく

統合メモリ環境では、このばらつきが
**p95 / p99 レイテンシの悪化**として顕在化しやすい。

---

### Alpamayo-R1 ではなぜ成立しているか

* dGPU（24GB 以上）前提
* オフライン / 低速評価が主
* 実時間制御の厳密性が低い

Jetson にそのまま適用すると、
**制御ループがテキスト生成の最悪ケースに引きずられる**。

---

### 同レートで回すなら必要な条件

* 生成長を **固定かつ短く（8–16 tokens）**
* 自由文ではなく **限定語彙（擬似言語）**
* スレッド分離 + priority 制御
* text は遅れたら **drop 可能**
* 評価指標は平均ではなく **p95 / p99**

---

## 推奨方針まとめ

* **軌道生成とテキスト生成は論理的に分離**
* policy は低レートでも安定を最優先
* テキストは

  * オンデマンド
  * 低頻度
  * 短文

これにより、Jetson Orin Nano 8GB 上でも
**「走れて、必要なときに説明できる VLA」**が成立する。

---

## 最終的な狙い

minipamayo は

> 「Alpamayo の思想を、エッジで破綻しない形に再設計した VLA」

であり、

* 常時すべてを同時にやることより
* **安定・再現性・制御品質を優先すること**

が最重要設計指針となる。
